
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>GRL: Coupling Physical Factors for Precipitation Forecast in China With Graph Neural Network - Aubrey Chen</title>

  
    <meta name="description" content="author: Chen Yutong, Wang Ya, Huang Gang, et al.作者：陈昱同，汪亚，黄刚，等. keywords: physics-constrained deep learning, graph neural network, precipitation forecast关键词：物理约束深度学习，图神经网络，降水预报 Abstract Precipitation">
<meta property="og:type" content="article">
<meta property="og:title" content="GRL: Coupling Physical Factors for Precipitation Forecast in China With Graph Neural Network">
<meta property="og:url" content="http://example.com/2024/11/06/my-pub-2/index.html">
<meta property="og:site_name" content="Aubrey Chen">
<meta property="og:description" content="author: Chen Yutong, Wang Ya, Huang Gang, et al.作者：陈昱同，汪亚，黄刚，等. keywords: physics-constrained deep learning, graph neural network, precipitation forecast关键词：物理约束深度学习，图神经网络，降水预报 Abstract Precipitation">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/my-pub-2/@1.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@2.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@3.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@4.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@5.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@6.svg">
<meta property="og:image" content="http://example.com/images/my-pub-2/@7.svg">
<meta property="article:published_time" content="2024-11-06T07:07:08.000Z">
<meta property="article:modified_time" content="2024-11-19T11:59:52.662Z">
<meta property="article:author" content="Chen Yu-tong (Aubrey Chen)">
<meta property="article:tag" content="DL">
<meta property="article:tag" content="forecast">
<meta property="article:tag" content="precipitation">
<meta property="article:tag" content="physics-constrained DL">
<meta property="article:tag" content="GNN">
<meta property="article:tag" content="weather">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/my-pub-2/@1.svg">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Aubrey Chen" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/images/homepage_avatar.webp" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Aubrey Chen</div><div class="sub cap">to record my academic life!</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>


<nav class="menu dis-select"><a class="nav-item" title="Post" href="/" style="color:#00BFFF"><svg t="1729300728920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3997" width="200" height="200"><path d="M783.725714-0.073143a109.714286 109.714286 0 0 0-78.262857 32.841143L102.912 632.32a36.571429 36.571429 0 0 0-9.362286 16.091429l-92.16 329.142857a36.571429 36.571429 0 0 0 45.056 45.056l329.142857-92.16a36.571429 36.571429 0 0 0 16.091429-9.362286l599.552-602.550857 0.146286-0.073143a109.714286 109.714286 0 0 0 0-155.648l-0.146286-0.073143L862.061714 32.841143a109.641143 109.641143 0 0 0-78.336-32.914286z" fill="currentColor" p-id="3998"></path></svg></a><a class="nav-item" title="PUBs" href="/pubs/" style="color:#00EE76"><svg t="1729300963470" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4146" width="200" height="200"><path d="M466.285714 120.905143C393.947429 80.384 258.633143 30.72 109.421714 13.092571 49.298286 5.997714 0 55.588571 0 116.150857v585.142857c0 60.635429 49.517714 108.909714 109.129143 119.734857 134.582857 24.429714 246.564571 88.941714 318.025143 139.995429 11.995429 8.557714 25.234286 14.994286 39.131428 19.456V120.905143z m91.428572 859.574857c13.897143-4.388571 27.062857-10.898286 39.058285-19.382857 71.460571-51.053714 183.442286-115.638857 318.098286-140.068572 59.611429-10.825143 109.129143-59.099429 109.129143-119.734857v-585.142857C1024 55.588571 974.701714 5.997714 914.578286 13.165714c-149.211429 17.700571-284.525714 67.291429-356.864 107.812572v859.574857z" fill="currentColor" p-id="4147"></path></svg></a><a class="nav-item" title="Column" href="/" style="color:#FFC125"><svg t="1729303802682" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3997" width="200" height="200"><path d="M448.146286 58.88A109.714286 109.714286 0 0 0 379.099429 36.571429H109.714286A109.714286 109.714286 0 0 0 0 146.285714v731.428572a109.714286 109.714286 0 0 0 109.714286 109.714285h804.571428A109.714286 109.714286 0 0 0 1024 877.714286V292.571429a109.714286 109.714286 0 0 0-109.714286-109.714286H503.954286l-15.725715-62.902857a109.860571 109.860571 0 0 0-40.082285-61.074286z" fill="currentColor" p-id="3998"></path></svg></a><a class="nav-item" title="Life" href="/" style="color:#FF6A6A"><svg t="1729301274725" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="200" height="200"><path d="M294.331977 79.36c71.68 5.193143 146.432 40.228571 217.965714 110.957714 71.533714-70.802286 146.212571-105.691429 217.819429-110.738285 80.896-5.778286 152.356571 26.916571 204.068571 78.482285 101.668571 101.376 133.632 284.891429 7.460572 411.062857a35.108571 35.108571 0 0 1-1.316572 1.243429L536.873691 935.862857a36.571429 36.571429 0 0 1-49.152 0L84.265691 570.368a36.205714 36.205714 0 0 1-1.316571-1.243429c-126.829714-126.829714-95.085714-310.345143 6.948571-411.648 51.858286-51.492571 123.465143-83.968 204.434286-78.116571z" fill="currentColor" p-id="4452"></path></svg></a></nav>
</div>
<div class="widgets">
<widget class="widget-wrapper markdown"><div class="widget-header dis-select"><span class="name">Personal Profile</span></div><div class="widget-body fs14"><p><b><font size=5 face="Lucida Handwriting">Chen Yu-Tong</font></b><br><br><font face="Segoe Print">PhD Candidate (incoming)</font><br><font face="Segoe Print" >Uni Leipzig</font><br><font face="Segoe Print" >AI for Atomspheric Sciences</font><br><font face="Segoe Print" ><a href="mailto:&#x41;&#117;&#x62;&#114;&#101;&#121;&#67;&#104;&#101;&#110;&#x79;&#116;&#64;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;">&#x41;&#117;&#x62;&#114;&#101;&#121;&#67;&#104;&#101;&#110;&#x79;&#116;&#64;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#x6f;&#109;</a></font></p>

<div class="linklist center" style="grid-template-columns:repeat(1,1fr);">
<a class="link" title="learn more about me" href="/about/"><div class="flex"><svg t="1729301383131" class="icon" viewBox="0 0 1027 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1003" width="200" height="200"><path d="M513.566305 298.622371m-298.622371 0a298.622371 298.622371 0 1 0 597.244742 0 298.622371 298.622371 0 1 0-597.244742 0Z" fill="#D8BFD8" p-id="1004"></path><path d="M1025.490369 921.88992l-24.742996-119.022345A263.640893 263.640893 0 0 0 738.38629 597.244742h-32.421858a91.719728 91.719728 0 0 0-39.674115 9.385275 367.305516 367.305516 0 0 1-305.448025 0 91.719728 91.719728 0 0 0-39.674115-9.385275h-32.421857a263.640893 263.640893 0 0 0-260.65467 205.622833L1.64224 921.88992A85.320677 85.320677 0 0 0 86.962917 1023.848129h849.793948A85.320677 85.320677 0 0 0 1025.490369 921.88992z" fill="#D8BFD8" p-id="1005"></path></svg><span>learn more about me</span></div></a></div></div></widget>

<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2024/11/06/my-pub-2/"><span class="title">GRL: Coupling Physical Factors for Precipitation Forecast in China With Graph Neural Network</span></a><a class="item title" href="/2024/10/20/my-pub-1/"><span class="title">Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model</span></a><a class="item title" href="/2024/09/25/About-me/"><span class="title">About me</span></a><a class="item title" href="/2024/09/23/cm2hl7wmy0006c85o5yzmbnir/"><span class="title">Hello World</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top"><img class="bg lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/banner/banner-ai_rain-2.webp">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/My-publication/">My publication</a></div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2024-11-06T07:07:08.000Z">2024-11-06</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2024-11-19T11:59:52.662Z">2024-11-19</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>GRL: Coupling Physical Factors for Precipitation Forecast in China With Graph Neural Network</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p>author: Chen Yutong, Wang Ya, Huang Gang, et al.<br>作者：陈昱同，汪亚，黄刚，等.</p>
<p>keywords: physics-constrained deep learning, graph neural network, precipitation forecast<br>关键词：物理约束深度学习，图神经网络，降水预报</p>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p style='text-align:justify; text-justify:inter-word'>
Precipitation exerts far-reaching impacts on both socio-economic fabric and individual well-being, necessitating concerted efforts in accurate forecasting. Deep learning (DL) models have increasingly demonstrated their prowess in forecasting meteorological elements. However, traditional DL prediction models often grapple with heavy rainfall forecasting. In this study, we propose physics-informed localized graph neural network (GNN) models called ω-GNN and ω-EGNN, constrained by the coupling of physical variables and climatological background to predict precipitation in China. These models exhibit notable and robust improvements in identifying heavy rainfall while maintaining excellent performance in forecasting light rain by comparing to numerical weather prediction (NWP) and other DL models with multiple perturbation experiments in different data sets. Surprisingly, within a certain range, even when a DL model utilizes more input variables, GNN can still maintain its advantage. The methods to fuse physics into DL model demonstrated in this study may be promising and call for future studies.
</p>
<p>
降水深刻影响着社会经济和个人福祉，需要学界共同努力来让预报更加精准。虽然近年的深度学习（DL）模型预报气象要素的能力越来越强，但传统的深度学习算法仍然难以预测出强降水事件。本研究提出了一组两套图神经网络降水预报模型ω-GNN和ω-EGNN，这组模型被物理量的耦合规律和大尺度气候背景所约束。在预报中国全境降水的任务中，相比于数值天气预报（NWP）和其他深度学习模型，本研究提出的物理约束图神经网络模型不仅显著且稳定地改善了强降水的预报结果，而且小降水的预报水平也没有下降。即使给其他深度学习模型在一定范围内输入更多信息，它们的预报效果也没能超过这组物理约束的图神经网络模型。可见，这种通过图神经网络融合物理与深度学习的方法有进一步研究的前景。
</p>

<p><a target="_blank" rel="noopener" href="https://doi.org/10.1029/2023GL106676">https://doi.org/10.1029/2023GL106676</a></p>
<h2 id="Point-1-Why-physics-constrainted-DL"><a href="#Point-1-Why-physics-constrainted-DL" class="headerlink" title="Point 1. Why physics-constrainted DL?"></a>Point 1. Why physics-constrainted DL?</h2><p style='text-align:justify; text-justify:inter-word'>
I am going to write a post specially for this issue. Please look forward to it.
</p>
<p>
我打算另开一帖来谈谈我对这个问题的理解，敬请期待。
</p>

<h2 id="Point-2-A-graph-of-precipitation-process"><a href="#Point-2-A-graph-of-precipitation-process" class="headerlink" title="Point 2. A graph of precipitation process"></a>Point 2. A graph of precipitation process</h2><p style='text-align:justify; text-justify:inter-word'>
A graph is a data structure composed of vertices and edges. Convolution can be operated on a graph, similar to convolutional neural network (CNN), in which grid data can also be seen as a kind of graph. As shown in the figure, the value on a center node (node of interest, NoI) will be aggregated with that of its neighbour nodes. Such aggregation is something like the "coupling" of each NoI and its neighbour nodes. Many layers of graph convolution form a graph neural network (GNN), which can realize the coupling between high-order neighbour nodes.
</p>
<p style='text-align:justify; text-justify:inter-word'>
GNN offers a potential tool to represent the coupling of physical variables in a specific process by putting physical variables on the vertices and connecting the related couple. Such a prior structure may reduce the degree of freedom of the deep learning (DL) model. In this study, a graph was abstracted from the precipitation process. The precipitation process was simply attributed to 2 conditions (physical variables): relative humidity (RH) and ascending motion (ω). ω was replaced by the coupling of other primary physical variables according to the ω-equation, as the data of ω is rare and low quality.
</p>
$$
(\partial_{pp} + \frac{\sigma}{f^2} \nabla^2) \omega \approx -\frac{1}{f} \partial_p {Adv}_\zeta - \frac{R}{pf^2} \nabla^2 {Adv}_T \tag{2.1}\label{2.1}
$$
<p style='text-align:justify; text-justify:inter-word'>
The GNN based on this abstracted graph is the core of the proposed physics-constrained DL model.
</p>
<p>
图（Graph）是一种由顶点（Vertex）和边（Edge）组成的数据结构。在图上也可以进行类似卷积神经网络（CNN）中的卷积运算（格点数据也可以视为一种图）。如图所示，图卷积（Graph Convolution）把中心节点（NoI）和它周围的邻居节点上的值混合在一起运算，得到的结果再赋给中心节点。这种运算可以形象地称为“聚合函数”（Aggregation Functi-on），具体算法按需拟定。聚合函数在形式上可以看作中心节点与邻居节点的某种“耦合”。多个图卷积层相连就能使中心节点与更高阶的邻居节点耦合，这就是图神经网络（GNN）。
</p>
<p>
对于一个物理过程，如果把涉及的物理量放在顶点，再把两两间的相互作用连起来，就能用图来表征这个过程。在耦合的过程中具体发生了什么，由GNN自己学习。如此相当于提前告知了深度学习模型一些模糊的物理知识，模型只需要在此基础上深化认知，任务难度也随之下降了，否则还要从头学起——这就是给模型施加了一种物理约束，降低了模型的自由度。本研究的核心就是把降水过程抽象成图，以此来约束深度学习模型。
</p>
<p>
降水的发生要满足两个因素：1.充足的水汽（相对湿度RH）；2.要有抬升运动（垂直速度ω）（暂不考虑凝结核的因素）。ω是个很难观测和计算的量，因此，本研究根据ω-方程$ \eqref{2.1} $所反应的耦合关系，用其他更基本的物理量替换了ω。由此构造出表征降水的物理过程的图，并建立GNN。
</p>
<div class="tag-plugin grid"  style="grid-template-columns: repeat(2, 1fr);"><div class="cell" style="">
    <div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@1.svg" alt="A sample of graph and graph convolution." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">A sample of graph and graph convolution.</span></div></div>
    </div>
    <div class="cell" style="">
    <div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@2.svg" alt="The graph of precipitation process abstracted in this study." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The graph of precipitation process abstracted in this study.</span></div></div>
    </div>
    </div>

<h2 id="Point-3-Embedding-climate-background"><a href="#Point-3-Embedding-climate-background" class="headerlink" title="Point 3. Embedding climate background"></a>Point 3. Embedding climate background</h2><p style='text-align:justify; text-justify:inter-word'>
In this study, only regional data was used -- specifically, grid data around China. However, what about the information outside China, for example, the climate background of larger scales like ENSO (of which the signal is on the Pacific Ocean far from China), which can also strongly influence China's weather and climate? In fact, action at a distance doesn't exist, so the large-scale climate background and its signals far away will first propagate to and act on the local conditions. That means, the large-scale information is essentially contained in the local data.
</p>
<p style='text-align:justify; text-justify:inter-word'>
There's more to the story. Again, local data potentially contains information on the climate background, which doesn't necessarily mean DL models can really capture this subtle information. Prior information will help DL models extract specific features more effectively, but how to do this?
</p>
<p style='text-align:justify; text-justify:inter-word'>
It's not worthwhile to input global data into the model, or we could have build a global model rather than a local model. Climate background can be conveniently described by climate indices like Nino 3.4 and etc. More generally speaking, the ENSO effect on China has only 3 types: positive phase, normal phase, and negative phase. They are sparse. Some other factors similarly take sparse values, such as season (spring, summer, autumn, winter). The problem is to make the DL model understand these sparse factors, or vice versa, make the sparse factors a form that can be taken in by the DL model.
</p>
<p style='text-align:justify; text-justify:inter-word'>
Entity embedding is such a technique (Guo and Berkhahn, 2016). It can map the sparse factors to dense, high-dimensional vectors according to the training data. Through entity embedding, this study turned ENSO phases, seasons, lead times, and valid times into understandable and learnable prompts for the DL model.
</p>
<p>
本研究只用到了中国附近的格点数据。那中国以外更大尺度的气候背景对中国的影响又怎么办？比如ENSO，其信号定义在南太平洋深处，并不在本研究划定的范围内。这一点其实不必担心，因为物理上并不存在“超距作用”，大尺度气候背景和遥远处的气候信号也必须先传播到研究区域内，对研究区域的大气状况产生作用，最终才能影响到当地的天气。换句话说，研究区域内的数据原来已经包含了更大尺度气候背景的信息。但这还不够，因为深度学习模型不能保证捕捉到这些微妙的气候背景信息。  
</p>
<p>
还是之前的想法，要用先验知识提示模型去学习特定的特征。没必要把全球格点数据都输入模型，那样的话做区域模型就失去意义了。即便是大尺度的气候背景也可以只用一个“气候指数”值来表示，比如Nino3.4指数，用起来十分方便。按这种思路进一步简化，ENSO对中国大气状况的影响也不过三种情况：正相位、中性相位和负相位。这种分法得到的结果具有稀疏性，类似的还有季节（分为春夏秋冬四季）等。现在的问题在于，如何让深度学习模型“理解”这些取值稀疏的因子，或者反过来说，怎么把这些稀疏的值转换为深度学习模型可以“理解”的形式。
</p>
<p>
实体嵌入（Entity Embedding）技术能把稀疏的对象映射到稠密的高维空间里，变成可以输入深度学习模型中的高维向量（Guo and Berkhahn, 2016）。本研究用这种方法把ENSO相位、季节、提前时间和预报时间都作为可习得的先验“提示”输入给深度学习模型。
</p>
<div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@3.svg" alt="Sparse factors mapped to dense vectors (2D projection)." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">Sparse factors mapped to dense vectors (2D projection).</span></div></div>

<h2 id="Point-4-The-architecture-of-the-model"><a href="#Point-4-The-architecture-of-the-model" class="headerlink" title="Point 4. The architecture of the model"></a>Point 4. The architecture of the model</h2><p style='text-align:justify; text-justify:inter-word'>
The figure below shows the architecture of the study's proposed DL model. Generally speaking, it is structured as an "Encoder-Coupler-Decoder". The CNN Encoder extracts low-dimensional features (namely, "encoding") from the six input variables respectively, and then the six features will be coupled in the Coupler. The Coupler is a GNN based on the graph presented in Point 2. After coupling, the coupled feature of precipitation will be up-sampled to a prognostic field. Between the Encoder and the Decoder are the skip connections, like in the U-net.
</p>
<p>
Notice that the embedding vector of the climate background (see in Point 3) was concatenated to the input variable fields. This study proposed two GNN models: the one with the GNN Coupler (see in Point 2) but without the climate background embedding called ω-GNN, and the one with both the GNN Coupler and the climate background embedding called ω-EGNN. 
</p>
<p>
如下图所示，本研究提出的深度学习模型大体上具有“编码器-耦合器-解码器”的结构。此处的编码器是一个CNN，负责提取输入数据的低维特征，此谓编码。把六个输入变量分别编码，再用Point 2中所述的GNN作为耦合器，对这六个变量的特征向量进行耦合运算。经过耦合后，把其中降水的特征向量挑出来，由上采样产生出预报场，即是解码。编码器和解码器之间还有类似U-net中的跳跃连接（Skip Connection）直接相连。注意：Point 3中提到的由气候背景因子转化成的向量直接和输入的变量场拼接在一起，以这种形式接受模型的后续处理。研究测试了两个GNN耦合模型，一个只有GNN耦合器，没有气候背景嵌入，称为ω-GNN；一个既有GNN耦合器，又有气候背景嵌入，称为ω-EGNN。
</p>
<div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@4.svg" alt="The graph of the precipitation process abstracted in this study." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The graph of the precipitation process abstracted in this study.</span></div></div>

<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p style='text-align:justify; text-justify:inter-word'>
Compared to numerical weather prediction (NWP) and other DL models, both the ω-GNN (with the GNN Coupler only) model and the ω-EGNN (with both the GNN Coupler and the climate background embedding) significantly improved the precipitation prediction, especially that of heavy precipitation. They also gained better stability than other DL models. ω-EGNN is slightly superior to ω-GNN. The two GNN models, as well as other DL models, were trained on two datasets of different sources, to find that the superiority of the two GNN models was maintained across different datasets.
</p>
<p style='text-align:justify; text-justify:inter-word'>
As to the physical interpretability, the figure in Point 3 shows that the ω-EGNN model successfully distinguished between the four seasons and between the different ENSO phases, which demonstrates that the model can indeed learn the knowledge about these climate backgrounds.
</p>
<p>
ω-GNN模型和ω-EGNN模型均能显著地改善降水、特别是强降水的预报水平；相比其他深度学习模型，结果也更加稳定。二者之中，ω-EGNN模型略胜一筹。把实验用到的所有深度学习模型都在两个来源不同的数据集上分别训练，则发现两个GNN耦合模型的优势能够泛化到不同的数据集上。
</p>
<p>
除了模型本身架构（GNN耦合器）所蕴含的物理意义，还可以从气候背景嵌入的角度观察ω-EGNN模型的物理可解释性。从Point 3的图中可以看到，不同的季节和ENSO相位已经被区分开来，说明模型成功地学到了相关的知识。
</p>
<div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@5.svg" alt="The prediction skills of the different models trained on the ERA-5 dataset." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The prediction skills of the different models trained on the ERA-5 dataset.</span></div></div>
<div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@6.svg" alt="The distribution of the TS difference, with threshold 20mm/6h, trained on ERA-5." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The distribution of the TS difference, with threshold 20mm/6h, trained on ERA-5.</span></div></div>
<div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-2/@7.svg" alt="The TS and the distribution of the TS difference with threshold 20mm/6h, trained on CMPA dataset." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The TS and the distribution of the TS difference with threshold 20mm/6h, trained on CMPA dataset.</span></div></div>
<div class="article-footer fs14">
    <section id="references">
      <div class="header"><span>References</span></div>
      <div class="body">
        <ul>
        <li class="post-title">
          <p><a target="_blank" rel="noopener" href="https://doi.org/10.48550/arXiv.1604.06737">Guo and Berkhahn, 2016, <em>Entity Embeddings of Categorical Variables</em></a></p>

        </li>
        </ul>
      </div>
    </section>
    
    <section id="license">
      <div class="header"><span>License</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"></div><div class="item" id="next"><div class="note">Older</div><a href="/2024/10/20/my-pub-1/">Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">Chen Yu-tong (Aubrey Chen)</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1">Stellar 1.29.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Abstract"><span class="toc-text">Abstract</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-1-Why-physics-constrainted-DL"><span class="toc-text">Point 1. Why physics-constrainted DL?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-2-A-graph-of-precipitation-process"><span class="toc-text">Point 2. A graph of precipitation process</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-3-Embedding-climate-background"><span class="toc-text">Point 3. Embedding climate background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-4-The-architecture-of-the-model"><span class="toc-text">Point 4. The architecture of the model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Results"><span class="toc-text">Results</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>Scroll to Top</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
