
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1" theme-name="Stellar" theme-version="1.29.1">
  
  <meta name="generator" content="Hexo 7.3.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  <meta name="theme-color" content="#f9fafb">
  
  <title>Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model - Aubrey Chen</title>

  
    <meta name="description" content="author: Chen Yutong, Huang Gang, Wang ya, et al.作者：陈昱同，黄刚，汪亚，等. keywords: bias correction deep learning data imbalance extreme rainfall关键词：偏差校正 深度学习 数据不均衡 极端降水 Abstract Weather forecasting has been pl">
<meta property="og:type" content="article">
<meta property="og:title" content="Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model">
<meta property="og:url" content="http://example.com/2024/10/20/my-pub-1/index.html">
<meta property="og:site_name" content="Aubrey Chen">
<meta property="og:description" content="author: Chen Yutong, Huang Gang, Wang ya, et al.作者：陈昱同，黄刚，汪亚，等. keywords: bias correction deep learning data imbalance extreme rainfall关键词：偏差校正 深度学习 数据不均衡 极端降水 Abstract Weather forecasting has been pl">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/my-pub-1/@1.jpg">
<meta property="og:image" content="http://example.com/images/my-pub-1/@2.png">
<meta property="article:published_time" content="2024-10-20T02:44:09.000Z">
<meta property="article:modified_time" content="2024-10-22T02:28:17.762Z">
<meta property="article:author" content="Chen Yu-tong (Aubrey Chen)">
<meta property="article:tag" content="DL">
<meta property="article:tag" content="U-net">
<meta property="article:tag" content="forecast">
<meta property="article:tag" content="precipitation">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/images/my-pub-1/@1.jpg">
  
  
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="Aubrey Chen" type="application/atom+xml">
  

  <link rel="stylesheet" href="/css/main.css?v=1.29.1">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://aubreychen-homepage-gallery.oss-cn-beijing.aliyuncs.com/imghomepage_avatar.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">Aubrey Chen</div><div class="sub cap">to record my academic life!</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>


<nav class="menu dis-select"><a class="nav-item" title="Post" href="/" style="color:#00BFFF"><svg t="1729300728920" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3997" width="200" height="200"><path d="M783.725714-0.073143a109.714286 109.714286 0 0 0-78.262857 32.841143L102.912 632.32a36.571429 36.571429 0 0 0-9.362286 16.091429l-92.16 329.142857a36.571429 36.571429 0 0 0 45.056 45.056l329.142857-92.16a36.571429 36.571429 0 0 0 16.091429-9.362286l599.552-602.550857 0.146286-0.073143a109.714286 109.714286 0 0 0 0-155.648l-0.146286-0.073143L862.061714 32.841143a109.641143 109.641143 0 0 0-78.336-32.914286z" fill="currentColor" p-id="3998"></path></svg></a><a class="nav-item" title="PUBs" href="/pubs/" style="color:#00EE76"><svg t="1729300963470" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4146" width="200" height="200"><path d="M466.285714 120.905143C393.947429 80.384 258.633143 30.72 109.421714 13.092571 49.298286 5.997714 0 55.588571 0 116.150857v585.142857c0 60.635429 49.517714 108.909714 109.129143 119.734857 134.582857 24.429714 246.564571 88.941714 318.025143 139.995429 11.995429 8.557714 25.234286 14.994286 39.131428 19.456V120.905143z m91.428572 859.574857c13.897143-4.388571 27.062857-10.898286 39.058285-19.382857 71.460571-51.053714 183.442286-115.638857 318.098286-140.068572 59.611429-10.825143 109.129143-59.099429 109.129143-119.734857v-585.142857C1024 55.588571 974.701714 5.997714 914.578286 13.165714c-149.211429 17.700571-284.525714 67.291429-356.864 107.812572v859.574857z" fill="currentColor" p-id="4147"></path></svg></a><a class="nav-item" title="Column" href="/" style="color:#FFC125"><svg t="1729303802682" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3997" width="200" height="200"><path d="M448.146286 58.88A109.714286 109.714286 0 0 0 379.099429 36.571429H109.714286A109.714286 109.714286 0 0 0 0 146.285714v731.428572a109.714286 109.714286 0 0 0 109.714286 109.714285h804.571428A109.714286 109.714286 0 0 0 1024 877.714286V292.571429a109.714286 109.714286 0 0 0-109.714286-109.714286H503.954286l-15.725715-62.902857a109.860571 109.860571 0 0 0-40.082285-61.074286z" fill="currentColor" p-id="3998"></path></svg></a><a class="nav-item" title="Life" href="/" style="color:#FF6A6A"><svg t="1729301274725" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="200" height="200"><path d="M294.331977 79.36c71.68 5.193143 146.432 40.228571 217.965714 110.957714 71.533714-70.802286 146.212571-105.691429 217.819429-110.738285 80.896-5.778286 152.356571 26.916571 204.068571 78.482285 101.668571 101.376 133.632 284.891429 7.460572 411.062857a35.108571 35.108571 0 0 1-1.316572 1.243429L536.873691 935.862857a36.571429 36.571429 0 0 1-49.152 0L84.265691 570.368a36.205714 36.205714 0 0 1-1.316571-1.243429c-126.829714-126.829714-95.085714-310.345143 6.948571-411.648 51.858286-51.492571 123.465143-83.968 204.434286-78.116571z" fill="currentColor" p-id="4452"></path></svg></a></nav>
</div>
<div class="widgets">
<widget class="widget-wrapper markdown"><div class="widget-header dis-select"><span class="name">Personal Profile</span></div><div class="widget-body fs14"><p><b><font size=5 face="Lucida Handwriting">Chen Yu-Tong</font></b><br><br><font face="Segoe Print">PhD Candidate (incoming)</font><br><font face="Segoe Print" >Uni Leipzig</font><br><font face="Segoe Print" >AI for Atomspheric Sciences</font><br><font face="Segoe Print" ><a href="mailto:&#x41;&#x75;&#98;&#x72;&#x65;&#x79;&#x43;&#x68;&#x65;&#110;&#x79;&#116;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#111;&#x6d;">&#x41;&#x75;&#98;&#x72;&#x65;&#x79;&#x43;&#x68;&#x65;&#110;&#x79;&#116;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#111;&#x6d;</a></font></p>

<div class="linklist center" style="grid-template-columns:repeat(1,1fr);">
<a class="link" title="learn more about me" href="/about/"><div class="flex"><svg t="1729301383131" class="icon" viewBox="0 0 1027 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1003" width="200" height="200"><path d="M513.566305 298.622371m-298.622371 0a298.622371 298.622371 0 1 0 597.244742 0 298.622371 298.622371 0 1 0-597.244742 0Z" fill="#D8BFD8" p-id="1004"></path><path d="M1025.490369 921.88992l-24.742996-119.022345A263.640893 263.640893 0 0 0 738.38629 597.244742h-32.421858a91.719728 91.719728 0 0 0-39.674115 9.385275 367.305516 367.305516 0 0 1-305.448025 0 91.719728 91.719728 0 0 0-39.674115-9.385275h-32.421857a263.640893 263.640893 0 0 0-260.65467 205.622833L1.64224 921.88992A85.320677 85.320677 0 0 0 86.962917 1023.848129h849.793948A85.320677 85.320677 0 0 0 1025.490369 921.88992z" fill="#D8BFD8" p-id="1005"></path></svg><span>learn more about me</span></div></a></div></div></widget>

<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2024/10/20/my-pub-1/"><span class="title">Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model</span></a><a class="item title" href="/2024/09/25/About-me/"><span class="title">About me</span></a><a class="item title" href="/2024/09/23/cm2hl7wmy0006c85o5yzmbnir/"><span class="title">Hello World</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top"><img class="bg lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/banner/banner-ai_rain-1.png">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/My-publication/">My publication</a></div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2024-10-20T02:44:09.000Z">2024-10-20</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2024-10-22T02:28:17.762Z">2024-10-22</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>Front. Environ. Sci.: Improving the heavy rainfall forecasting using a weighted deep learning model</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p>author: Chen Yutong, Huang Gang, Wang ya, et al.<br>作者：陈昱同，黄刚，汪亚，等.</p>
<p>keywords: bias correction deep learning data imbalance extreme rainfall<br>关键词：偏差校正 深度学习 数据不均衡 极端降水</p>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p style='text-align:justify; text-justify:inter-word'>
Weather forecasting has been playing an important role in socio-economics. However, operational numerical weather prediction (NWP) is insufficiently accurate in terms of precipitation forecasting, especially for heavy rainfalls. Previous works on NWP bias correction utilizing deep learning (DL) methods mostly focused on a local region, and the China-wide precipitation forecast correction had not been attempted. Meanwhile, earlier studies imposed no particular focus on strong rainfalls despite their severe catastrophic impacts. In this study, we propose a DL model called weighted U-Net (WU-Net) that incorporates sample weights for various precipitation events to improve the forecasts of intensive precipitation in China. It is found that WU-Net can further improve the forecasting skill of heaviest rainfall comparing with the ordinary U-Net and ECMWF-IFS. Further analysis shows that this improvement increases with growing lead time, and distributes mainly in the eastern parts of China. This study suggests that a DL model considering the imbalance of the meteorological data could further improve the precipitation forecasting generated by numerical weather prediction.
</p>
天气预报在社会经济生活中扮演者重要的角色。然而，数值天气预报（NWP）业务对降水、特别是强降水的预报还不够准确。过去利用深度学习（DL）对NWP进行校正的工作大多聚焦于局地，还没有校正整个中国范围内降水整体预报的尝试。同时，前人的研究也没有着重处理能引起严重灾害的强降水。本研究利用U-net算法，通过在训练时赋予降水事件不同的权重，构建了一个样本加权U-net（WU-net），以期改善对中国范围内强降水的预报。研究发现，相比于NWP乃至一般的U-net，WU-net能够进一步提升对强降水的预报技巧。后续分析亦显示此改善随着预报提前时间的增长而持续提高。从空间分布上看，改善主要集中在中国东部。这些发现表明，预置了样本不均衡信息的DL模型有能力改善NWP的降水预报。

<p><a target="_blank" rel="noopener" href="https://doi.org/10.3389/fenvs.2023.1116672">https://doi.org/10.3389/fenvs.2023.1116672</a></p>
<h2 id="Point-1-Data-imbalance"><a href="#Point-1-Data-imbalance" class="headerlink" title="Point 1. Data imbalance"></a>Point 1. Data imbalance</h2><div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-1/@1.jpg" alt="The occurrence of each precipitation level in the dataset." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The occurrence of each precipitation level in the dataset.</span></div></div>
<p style='text-align:justify; text-justify:inter-word'>
The quantity of precipitation has a long-tailed distribution. Too few extreme samples will mislead DL, as a statistical method, to neglecting them. As a result, DL usually performs poorly in prediction heavy rainfall.
</p>
不同降水量的发生频率呈长尾分布——极端大的降水事件极少发生，因而在整个数据集中只有很少的样本。因此，作为一种具有统计性质的方法，深度学习往往会忽略这些极端降水的信息，导致强降水预报效果较差。

<h2 id="Point-2-U-net"><a href="#Point-2-U-net" class="headerlink" title="Point 2. U-net"></a>Point 2. U-net</h2><div class="tag-plugin image"><div class="image-bg" style="padding:16px;"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="/images/my-pub-1/@2.png" alt="The architecture of the U-Net using in this study." data-fancybox="true" style="width:800px;"/></div><div class="image-meta"><span class="image-caption center">The architecture of the U-Net using in this study.</span></div></div>
<p style='text-align:justify; text-justify:inter-word'>
U-net is a popular DL architecture in computer vision (CV), first proposed for biomedical segmentation. It gets its name from its U-shaped architecture. The down-branch functions as an encoder to extract the features from the input data. The up-branch is opposite, as a decoder, restoring the low-dimension features to prognostic fields. The skip connections tranmit features of different levels from the down-branch to the up-branch. In this study, a U-net was built to capture the features of input meteorologic data and produce weather predictions.
</p>
U-net是计算机视觉（CV）领域常用的一种深度学习架构，最早是为解决医学图像分割问题而提出的。U-net得名于它特殊的U型结构。其中，下行支作为编码器，提取输入数据的特征；上行支则作为解码器，把低维特征还原为预报场。在两者之间存在跳连，把不同层次的特征从编码器传递给解码器。本研究即建立了一个U-net模型，用以捕捉输入的气象数据的特征，并以此作出预报。

<h2 id="Point-3-Sample-weight"><a href="#Point-3-Sample-weight" class="headerlink" title="Point 3. Sample weight"></a>Point 3. Sample weight</h2><p style='text-align:justify; text-justify:inter-word'>
As mentioned in Point 1, data imbalance will aggravate the performance of DL on heavy precipitation. Therefore, the precipitation was graded by grid and assigned different weights according to:
</p>
$$
w_{i} = \frac{S}{n \times s_{i}} \tag{3.1}\label{3.1}
$$
<p style='text-align:justify; text-justify:inter-word'>
where $ S $ is the number of all the sample grid, $ n $ is the number of grades and $ s_{i} $ is the number of the sample gird of grade i. Grades with fewer occurrence would get larger weights, making the DL model learned more sufficiently about them. These weights was actually implemented in the loss function:
</p>
$$
Loss(x) = -w_{arg y_{j} = 1} \sum_{j = 1}^{n} y_{i} log P_{j}(x) \tag{3.2}\label{3.2}
$$
<p style='text-align:justify; text-justify:inter-word'>
among which $ j $ represents each dimension of the probability vector (the output of the softmax layer), and $ w_{arg y_{j} = 1} $ means the weight values $ w_{j} $ when the ground truth of the sample grid is in grade j. The U-net trained with this loss function is referred as weighted U-Net (WU-Net).
</p>
如Point 1中所述，样本不均衡使得深度学习模型难以较好地预测强降水事件。为了解决这一问题，我们把降水量按大小划分等级，并按式 $ \eqref{3.1} $ 赋予权重。式中 $ S $ 是样本总量（格点数），$ n $ 是总的等级数，$ s_{i} $ 是等级为i的样本总量。样本总量越少的等级，得到的权重越大，在训练时也将被更充分地“学习”。该权重实际是在损失函数$ \eqref{3.2} $中起作用的。式中 $ j $ 表示softmax层输出的概率向量的各维，$ w_{arg y_{j} = 1} $ 说明当样本点的实际降水等级为j时，权重取 $ w_{j} $。用这一加权的损失函数训练的U-net，我们称之为WU-net。
<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>License</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"></div><div class="item" id="next"><div class="note">Older</div><a href="/2024/09/25/About-me/">About me</a></div></section></div>






<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">Chen Yu-tong (Aubrey Chen)</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.29.1">Stellar 1.29.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Abstract"><span class="toc-text">Abstract</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-1-Data-imbalance"><span class="toc-text">Point 1. Data imbalance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-2-U-net"><span class="toc-text">Point 2. U-net</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Point-3-Sample-weight"><span class="toc-text">Point 3. Sample weight</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>Scroll to Top</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"skip_search":null,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js`,
    marked: `https://cdn.jsdelivr.net/npm/marked@13.0.1/lib/marked.umd.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.29.1" defer></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->



<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/flying-pages@2/flying-pages.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css`,
    js: `https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true
  }
});
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
